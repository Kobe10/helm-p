function getGlobalPathRoot(){var a=document.getElementById("systemScript").getAttribute("contextPath");if(a==undefined){alert("引入system.js需要指定id为systemScript，同时提供contextPath属性")}else{return a}}function fomateDate(b,c,a){c=c.replace("YYYY",b.getFullYear());c=c.replace("YY",String(b.getFullYear()).substr(2));c=c.replace("MM",b.getMonth()+1);c=c.replace("DD",b.getDate());c=c.replace("hh",b.getHours());c=c.replace("mm",b.getMinutes());c=c.replace("ss",b.getSeconds());if(a){c=c.replace(/\b(\d)\b/g,"0$1")}return c}function isIE(){if(!!window.ActiveXObject||"ActiveXObject" in window){return true}else{return false}}function stopEvent(a){if(!a){return}if(a.stopPropagation){a.stopPropagation()}else{a.cancelBubble=true}if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}}function setPCookie(d,c,b){var a=new Date();a.setFullYear(2050,12,31);$.cookie(d,c,{expires:a,path:b,secure:false})}function getPrjCd(){var a=$("#sysPrjCd").val();if(!a){a=""}return a}var JMap=function(){this.clear()};JMap.prototype.clear=function(){this.data={}};JMap.prototype.add=function(b,a){if(typeof(a)=="object"&&a!=null){this.serialize(this.data,b,a)}this.data[b]=a};JMap.prototype.serialize=function(e,b,g){if(g.length){var f=g.length;for(var c=0;c<f;c++){var a=b+"["+c+"]";if(g[c]&&typeof(g[c])=="object"){jmap=new JMap();jmap.serialize(e,a,g[c])}else{e[a]=g[c]}}}else{for(var d in g){if(typeof(g[d])=="object"){jmap=new JMap();jmap.serialize(e,d,g[d])}else{e[d]=g[d]}}}};JMap.prototype.findValueByName=function(a){return this.data[a]};function Map(){this.obj={}}Map.prototype.put=function(a,b){this.obj[a]=b};Map.prototype.get=function(a){return this.obj[a]};Map.prototype.remove=function(a){if(this.get(a)==undefined){return}delete this.obj[a]};Map.prototype.containsKey=function(a){if(this.get(a)==undefined){return false}else{return true}};Map.prototype.clear=function(){this.obj={}};Map.prototype.size=function(){var a=this.keys();return a.length};Map.prototype.keys=function(){var b=[];for(var a in this.obj){b.push(a)}return b};Map.prototype.values=function(){var b=[];for(var a in this.obj){b.push(this.obj[a])}return b};String.prototype.startWith=function(b){var a=new RegExp("^"+b);return a.test(this)};String.prototype.endWith=function(b){var a=new RegExp(b+"$");return a.test(this)};String.prototype.isImg=function(){var b=".jpeg|.gif|.jpg|.png|.bmp|.pic|";if(this.indexOf(".")>-1){var c=this.lastIndexOf(".");var a=this.substring(c,this.length)+"|";a=a.toLowerCase();if(b.indexOf(a)>-1){return true}}return false};var TitleFormat={split_str:function(d,b){if(typeof d=="undefined"||d.length==0){return""}if(typeof b=="undefined"||isNaN(b)||b==0){var f=d.substring(0,1);var a=1;var c=d;for(var e=1;e<d.length;e++){if(e==a){if(a==1){f+=""}else{f+="<br/>"}c=d.substring(a-1,d.length);a=a+c.indexOf(",")+1}f+=d.substring(e,e+1)}}else{b=parseInt(b);f=d.substring(0,1);for(e=1;e<d.length;e++){if(e%b==0){f+="<br/>"}f+=d.substring(e,e+1)}}return f},titleMouseOver:function(h,a,g){if(typeof h.title=="undefined"||h.title==""){return false}var j=document.getElementById("title_show");if(j==null){j=document.createElement("div");document.getElementsByTagName("body")[0].appendChild(j);var b=document.createAttribute("id");b.nodeValue="title_show";j.setAttributeNode(b);var f=document.createAttribute("style");f.nodeValue="position:absolute;text-align: left;border:solid 1px #999999; background:#f5f6f8;border-radius:2px;box-shadow:2px 3px #999999;line-height:18px;z-index:1010;font-size:12px; padding: 2px 5px;";try{j.setAttributeNode(f)}catch(k){j.style.position="absolute";j.style.border="solid 1px #999999";j.style.background="#EDEEF0";j.style.lineHeight="18px";j.style.fontSize="18px";j.style.padding="2px 5px"}}document.title_value=h.title;h.title="";if(typeof g=="undefined"||isNaN(g)){g=0}g=parseInt(g);j.innerHTML=this.split_str(document.title_value,g);j.style.display="block";a=a||window.event;var d=15;var c=Math.min(a.clientX,document.body.clientWidth-j.clientWidth);j.style.left=c+"px";j.style.top=(a.clientY+d)+"px"},titleMouseOut:function(a){var b=document.getElementById("title_show");if(b==null){return false}a.title=document.title_value;b.style.display="none";document.title_value=null;b=null}};var OpLog={opCode:null,click:function(a){if($(a).attr("rhtCd")){OpLog.opCode=$(a).attr("rhtCd")}}};var core={};core.version="2.00";$.ajaxSetup({cache:true});core.ajax={receivePacket:function(a){},sendPacket:function(packet,process,aysncflag){var defaultTimeouts="60000";if(packet.timeout){defaultTimeouts=packet.timeout}if(aysncflag==null){aysncflag=true}var showCover=true;if(packet.noCover){showCover=!packet.noCover}var sendUrl=packet.url;var sendData=packet.data.data;if(packet.clickObject){$(packet.clickObject).attr("disabled",true);if($(packet.clickObject).attr("class")){var _class=$(packet.clickObject).attr("class").split(" "),_btnClass="";for(var i=0;i<_class.length;i++){if(/^big/.test(_class[i])){_btnClass=_class[i];break}}if(!$(packet.clickObject).hasClass(_btnClass+"_dis")){$(packet.clickObject).addClass(_btnClass+"_dis")}}}var ajaxbg=null;if(showCover){ajaxbg=$("#background,#progressBar");ajaxbg.show()}$.ajax({url:sendUrl,data:sendData,type:"POST",async:aysncflag,dataType:"html",contentType:"application/x-www-form-urlencoded;charset=UTF-8",complete:function(XMLHttpRequest,textStatus){if(ajaxbg){ajaxbg.hide()}},success:function(data){eval(data);process&&process(response);response=null;if(packet.clickObject){$(packet.clickObject).removeAttr("disabled");if($(packet.clickObject).attr("class")){var _class=$(packet.clickObject).attr("class").split(" "),_btnClass="";for(var i=0;i<_class.length;i++){if(/^big/.test(_class[i])){_btnClass=_class[i];break}}if($(packet.clickObject).hasClass(_btnClass+"_dis")){$(packet.clickObject).removeClass(_btnClass+"_dis")}}}},error:function(data){if(data.status=="404"){alertMsg.warn("文件不存在!")}else{if(data.status=="500"){var errorJsonStr=data.getResponseHeader("Error-Json");if(errorJsonStr!=null||errorJsonStr!=""){var errorJson=eval("("+errorJsonStr+")");if(errorJson.code&&errorJson.code=="121004"){top.alertMsg.warn("用户未登录或登录失效!")}else{if(errorJson.code&&errorJson.code=="121005"){top.alertMsg.warn("禁止非法进入系统!")}else{alertMsg.warn("服务信息返回错误!")}}}else{alertMsg.warn("服务信息返回错误!")}}else{alertMsg.warn("SYS-"+data.status+":系统错误!")}}if(packet.clickObject){$(packet.clickObject).removeAttr("disabled")}if(data.statusText=="timeout"){alertMsg.warn("页面加载超时，请重试!")}}})},sendPacketHtml:function(packet,process,aysncflag){var defaultTimeouts="60000";if(packet.timeout){defaultTimeouts=packet.timeout}if(aysncflag==null){aysncflag=true}var showCover=true;if(packet.noCover){showCover=!packet.noCover}var ajaxbg=null;if(showCover){ajaxbg=$("#background,#progressBar");ajaxbg.show()}var sendUrl=packet.url;if(OpLog.opCode==null){OpLog.opCode=""}if(sendUrl.indexOf("?")!="-1"){sendUrl+="&opCode="+OpLog.opCode}else{sendUrl+="?opCode="+OpLog.opCode}var sendData=packet.data.data;if(packet.clickObject){$(packet.clickObject).attr("disabled",true);if($(packet.clickObject).attr("class")){var _class=$(packet.clickObject).attr("class").split(" "),_btnClass="";for(var i=0;i<_class.length;i++){if(/^big/.test(_class[i])){_btnClass=_class[i];break}}if(!$(packet.clickObject).hasClass(_btnClass+"_dis")){$(packet.clickObject).addClass(_btnClass+"_dis")}}}$.ajax({url:sendUrl,data:sendData,type:"POST",async:aysncflag,dataType:"html",contentType:"application/x-www-form-urlencoded;charset=UTF-8",complete:function(XMLHttpRequest,textStatus){if(ajaxbg){ajaxbg.hide()}},success:function(data){if(isIE()){data=data.replace(/td>\s+<td/g,"td><td")}process&&process(data);if(packet.clickObject){$(packet.clickObject).removeAttr("disabled");if($(packet.clickObject).attr("class")){var _class=$(packet.clickObject).attr("class").split(" "),_btnClass="";for(var i=0;i<_class.length;i++){if(/^big/.test(_class[i])){_btnClass=_class[i];break}}if($(packet.clickObject).hasClass(_btnClass+"_dis")){$(packet.clickObject).removeClass(_btnClass+"_dis")}}}},error:function(data){if(packet.errorFunction){packet.errorFunction(data)}else{if(data.status=="404"){alertMsg.warn("文件不存在!")}else{if(data.status=="500"){var errorJsonStr=data.getResponseHeader("Error-Json");if(errorJsonStr!=null||errorJsonStr!=""){var errorJson=eval("("+errorJsonStr+")");if(errorJson.code&&errorJson.code=="121004"){top.alertMsg.warn("用户未登录或登录失效!")}else{if(errorJson.code&&errorJson.code=="121005"){top.alertMsg.warn("禁止非法进入系统!")}else{alertMsg.warn("服务信息返回错误!")}}}else{alertMsg.warn("服务信息返回错误!")}}else{alertMsg.warn("系统错误,错误编码："+data.status)}}if(data.statusText=="timeout"){alertMsg.warn("页面加载超时，请重试!")}}if(packet.clickObject){$(packet.clickObject).removeAttr("disabled")}}})},sendHPacket:function(packet,process,aysncflag){var defaultTimeouts="60000";if(packet.timeout){defaultTimeouts=packet.timeout}if(aysncflag==null){aysncflag=true}var showCover=true;if(packet.noCover){showCover=!packet.noCover}var ajaxbg=null;if(showCover){ajaxbg=$("#background,#progressBar");ajaxbg.show()}var sendUrl=packet.url;var sendData=packet.data.data;if(packet.clickObject){$(packet.clickObject).attr("disabled",true);if($(packet.clickObject).attr("class")){var _class=$(packet.clickObject).attr("class").split(" "),_btnClass="";for(var i=0;i<_class.length;i++){if(/^big/.test(_class[i])){_btnClass=_class[i];break}}if(!$(packet.clickObject).hasClass(_btnClass+"_dis")){$(packet.clickObject).addClass(_btnClass+"_dis")}}}$.ajax({url:sendUrl,processData:false,data:JSON.stringify(sendData),type:"POST",async:aysncflag,dataType:"html",contentType:"application/json;charset=UTF-8",complete:function(XMLHttpRequest,textStatus){if(ajaxbg){ajaxbg.hide()}},success:function(data){process&&process(data);if(packet.clickObject){$(packet.clickObject).removeAttr("disabled");if($(packet.clickObject).attr("class")){var _class=$(packet.clickObject).attr("class").split(" "),_btnClass="";for(var i=0;i<_class.length;i++){if(/^big/.test(_class[i])){_btnClass=_class[i];break}}if($(packet.clickObject).hasClass(_btnClass+"_dis")){$(packet.clickObject).removeClass(_btnClass+"_dis")}}}},error:function(data){if(packet.errorFunction){packet.errorFunction(data)}else{if(data.status=="404"){alertMsg.warn("文件不存在!")}else{if(data.status=="500"){var errorJsonStr=data.getResponseHeader("Error-Json");if(errorJsonStr!=null||errorJsonStr!=""){var errorJson=eval("("+errorJsonStr+")");if(errorJson.code&&errorJson.code=="121004"){top.alertMsg.warn("用户未登录或登录失效!")}else{if(errorJson.code&&errorJson.code=="121005"){top.alertMsg.warn("禁止非法进入系统!")}else{alertMsg.warn("服务信息返回错误!")}}}else{alertMsg.warn("服务信息返回错误!")}}else{alertMsg.warn("系统错误,错误编码："+data.status)}}if(data.statusText=="timeout"){alertMsg.warn("页面加载超时，请重试!")}}if(packet.clickObject){$(packet.clickObject).removeAttr("disabled")}}})},dynamicLoadpage:function(b,c,a){core.ajax.sendPacketHtml(b,function(d){$("#"+c).html(d)},a)},loadjs:function(response){var f=response.match(/<script(.|\n)*?>(.|\n|\r\n)*?<\/script>/ig);if(f){for(var i=0;i<f.length;i++){var st=f[i].match(/<script(.|\n)*?>((.|\n|\r\n)*)?<\/script>/im)[2];if(st){window.eval(st)}else{var jsfile=$(f[i]);$("body").append(jsfile)}}}}};AJAXPacket=function(a,d,c,b){this.url=a;this.clickObject=c;this.data=new JMap();this.statusText=d;this.guid="";this.timeout=b};(function(a){a.fn.openTip=function(p){a("#openTip").remove();var l={};var j=a("<div id='openTip' class='tip' style='z-index: 1005'></div>");var m=a(this);var o={height:"200",offsetX:0,offsetY:0,args:{}};if(a.isPlainObject(p)){l=a.extend(o,p)}if(m.is("div")&&m.hasClass("unitBox")){m.append(j)}else{if(l.appendBody){var k=l.appendObj;if(!k||k.length==0){k=navTab.getCurrentPanel()}var h=l.relObj;if(!h||h.length==0){h=m}var e=h.offset();var d=e.top+h.outerHeight()-k.offset().top;var g=e.left-k.offset().left;var f={top:d,left:g};if(l.offsetY){f.top=f.top+l.offsetY}if(l.offsetX){f.left=f.left+l.offsetX}j.css(f);if(!l.width){l.width=h.outerWidth()}j.css({height:l.height,width:l.width});k.append(j)}else{var n=l.offsetY;var b=l.offsetX;j.css({left:b+"px",top:n+"px",width:l.width?l.width:"120",height:l.height,appendBody:false});j.insertAfter(m)}}j.data("clickObj",m);if(l.href){var c=new AJAXPacket(l.href);c.data.data=l.args;core.ajax.sendPacketHtml(c,function(q){j.html(q);initUI(j);j.css({overflow:"auto"})},true,false);c=null}else{if(l.html){j.html(l.html);initUI(j);j.css({overflow:"auto"})}else{initUI(j);j.css({overflow:"auto"})}}if(m.is("input")||m.is("a")){eventType="click"}else{eventType="click"}j.bind("click",function(q){q.stopPropagation()})};a.fn.closeTip=function(b){a(this).closest("div.tip").remove()};a.fn.openBtnMenu=function(k){if(!k){k={}}var e=navTab.getCurrentPanel();if(k.btnContainer){e=a.pdialog.getCurrent()}a("#btnMenu",e).remove();var j=k.relObj;if(!j){j=a(this)}if(j.find("ul.menu li").length==0){return}var g=e.offset();var b=j.find("ul.menu").clone();if(!k.openDirection){b.append(a('<div class="triangle triangle-right" style="border-left-color: #2c7bae;right: -10px; top: 3px;"></div>'))}else{if(k.openDirection=="down"){b.append(a('<div class="triangle triangle-up" style="border-bottom-color: #2c7bae;left: 20px; top: -10px;"></div>'))}}a(e).append(b);var f=j.offset();var c=f.top-g.top;var d=f.left-g.left-10;if(!k.offsetX){d=d-b.outerWidth()-1}else{d=d-k.offsetX}if(k.offsetY){c=c-k.offsetY}var h={top:c,left:d};b.css(h).attr("id","btnMenu").attr("active","on");b.data("relObj",j);b.mouseover(a.fn.activeBtnMenu);b.find("li").mouseover(a.fn.activeBtnMenu);b.find("li").click(function(){a("#btnMenu").remove()});b.mouseout(function(){a.fn.deActiveBtnMenu()});b.removeClass("hidden")};a.fn.activeBtnMenu=function(){var b=a(document);a("#btnMenu",b).attr("active","on")};a.fn.deActiveBtnMenu=function(){var b=a(document);a("#btnMenu",b).attr("active","off");setTimeout(function(){a.fn.removeBtnMenu()},300)};a.fn.removeBtnMenu=function(b){var d=a(document);var c=a("#btnMenu",d).attr("active");if("on"!=c){a("#btnMenu",d).remove()}}})(jQuery);var file={upLoadedFiles:[],defaultDocTypeRelUrl:function(){var a=$("#uploadDocTypeName",$.pdialog.getCurrent()).attr("typeItemCd");return getGlobalPathRoot()+"oframe/sysmg/sys005/sys005-data.gv?prjCd="+getPrjCd()+"&itemCd="+a},getDocTypeRelUrl:function(){var a=$("#uploadDocTypeName",$.pdialog.getCurrent()).attr("typeItemCd");return getGlobalPathRoot()+"oframe/sysmg/sys005/sys005-data.gv?prjCd="+getPrjCd()+"&itemCd="+a},successCallBack:null,openSUpload:function(j,d,c,g,h,b,e,f){var a=getGlobalPathRoot()+"oframe/common/file/file-init.gv?prjCd="+h+"&docTypeName="+g+"&docIds="+b+"&editAble="+e+"&relType="+d+"&relId="+c+"&subDir="+f;$.pdialog.open(a,"file","附件上传",{height:600,width:800,mask:true,param:{clickSpan:j}})},openAUpload:function(k,d,c,h,j,b,e,g,f){var a=getGlobalPathRoot()+"oframe/common/file/file-uploadFile.gv?prjCd="+j+"&docTypeName="+h+"&docIds="+b+"&editAble="+e+"&typeItemCd="+f+"&relType="+d+"&relId="+c+"&subDir="+g;$.pdialog.open(a,"file","附件上传",{height:600,width:800,mask:true,param:{clickSpan:k}})},startUpload:function(a){var b=$(a).closest("table");var c=b.find("input[name=docTypeName]").val();if(c!=""){$("#fileUpload").uploadify("upload","*")}else{alertMsg.warn("附件类型必须选择")}},getDocTypeRelOpt:function(a){return{processData:function(b){var d=[];for(i=0;i<b.length;i++){var c={};c.data=b[i];c.value=b[i].value;d.push(c)}return d},showResult:function(c,b){return b.value},displayValue:function(c,b){return b.value},onItemSelect:function(b){$("input[name=docTypeName]",$.pdialog.getCurrent()).val(b.data.value)},remoteDataType:"json",delay:300,minChars:0,sortResults:false,filterResults:false}},closeD:function(){return scan.closeScan()},getAllUploadFiles:function(){var a=[];$("div.js_upload span.js_pic_span",$.pdialog.getCurrent()).each(function(){var g=$(this);var f=g.attr("docId");if(f!=""){var e={};e.docId=f;e.fileName=g.attr("docName");e.docPath=g.attr("docPath");a.push(e)}});$("div.js_uploaded span.js_pic_span",$.pdialog.getCurrent()).each(function(){var h=$(this);var g=h.find("input[type=checkbox]").attr("checked");if(g){var f=h.attr("docId");if(f!=""){var e={};e.docId=f;e.fileName=h.attr("docName");e.docPath=h.attr("docPath");a.push(e)}}});var d=scan.getUploadFiles();for(var c=0;c<d.length;c++){var b={};b.docId=d[c].docId;b.fileName=d[c].fileName;b.docPath=d[c].docPath;a.push(b)}return a},uploadSuccess:false,uploadifySuccess:function(upfile,data,response){var jsonData=eval("("+data+")");var docId=jsonData.data[0].docId;var hiddenSpan=$("#uploadContain").find("span.hidden");var newSpan=hiddenSpan.clone();$(newSpan).find("a span").html(upfile.name);$(newSpan).find("img").attr("docId",docId);$(newSpan).attr("docId",docId);if(upfile.name.isImg()){$(newSpan).find("img").attr("src",getGlobalPathRoot()+"oframe/common/file/file-download.gv?docId="+docId)}var tempFileItem={};tempFileItem.docId=docId;tempFileItem.fileName=upfile.name;tempFileItem.docPath=jsonData.data[0].docPath;$(newSpan).attr("docId",tempFileItem.docId);$(newSpan).attr("docName",tempFileItem.fileName);$(newSpan).attr("docPath",tempFileItem.docPath);$(newSpan).removeClass("hidden");hiddenSpan.parent().append(newSpan);file.upLoadedFiles.push(tempFileItem)},saveUpFile:function(){var jsonData={};var $form=$("#scan001",$.pdialog.getCurrent());if($form.length>0&&$form.valid()){jsonData=$form.serializeArray()}var docIdArr=[];for(var i=0;i<file.upLoadedFiles.length;i++){docIdArr.push(file.upLoadedFiles[i].docId)}if(docIdArr.length==0&&jsonData.length==0){file.getDocTypeRelUrl=file.defaultDocTypeRelUrl;file.successCallBack=null;scan.closeScan();$.pdialog.closeCurrent();return}jsonData.push({name:"docId",value:docIdArr.join(",")});jsonData.push({name:"docTypeName",value:$("input[name=docTypeName]",$.pdialog.getCurrent()).val()});jsonData.push({name:"relType",value:$("input[name=relType]",$.pdialog.getCurrent()).val()});jsonData.push({name:"relId",value:$("input[name=relId]",$.pdialog.getCurrent()).val()});jsonData.push({name:"prjCd",value:getPrjCd()});var url=getGlobalPathRoot()+"oframe/common/file/file-updateFileRel.gv";if(docIdArr.length==0){url=getGlobalPathRoot()+"oframe/common/file/file-upbase64.gv"}var ajaxPacket=new AJAXPacket(url);ajaxPacket.data.data=jsonData;core.ajax.sendHPacket(ajaxPacket,function(response){var jsonData=eval("("+response+")");var isSuccess=jsonData.success;if(isSuccess){file.uploadSuccess=true;var fileArray=jsonData.data;for(var i=0;i<fileArray.length;i++){var tempFileItem={};tempFileItem.docId=jsonData.data[i].docId;tempFileItem.fileName=jsonData.data[i].docName;tempFileItem.docPath=jsonData.data[i].docPath;scan.upLoadedFiles.push(tempFileItem)}var callBackResult=true;if($.isFunction(file.successCallBack)){callBackResult=file.successCallBack(file.getAllUploadFiles())}if(callBackResult){file.getDocTypeRelUrl=file.defaultDocTypeRelUrl;file.successCallBack=null;scan.closeScan();$.pdialog.closeCurrent()}else{return false}}else{alertMsg.error(jsonData.errMsg)}})},removeFile:function(a){$(a).parent().remove()},viewImg:function(a){var b=$(a).attr("src");if(""!=b){$(a).parents("div:eq(0)").find("img.selected").removeClass("selected");$(a).addClass("selected");window.open(b)}},viewPdf:function(b){var a=$(b).attr("docId");window.open(getGlobalPathRoot()+"oframe/common/file/file-viewPdf.gv?prjCd="+getPrjCd()+"&docId="+a)},removeImg:function(obj){var src=$(obj).parent().find("img").attr("src");if(src!=null){var showSrc=$("#file_imgViewer").attr("src");if(showSrc==src){$("#file_imgViewer").attr("src","").hide()}}var docId=$(obj).closest("span.js_pic_span").attr("docId");if(docId){alertMsg.confirm("确定删除该附件吗？",{okCall:function(){var packet=new AJAXPacket();packet.data.add("docId",docId);packet.url=getGlobalPathRoot()+"/oframe/common/file/file-delete.gv";core.ajax.sendPacketHtml(packet,function(response){var jsonData=eval("("+response+")");var isSuccess=jsonData.success;if(isSuccess){$(obj).closest("span.js_pic_span").remove()}else{alertMsg.error(jsonData.errMsg)}},true)}})}},getUploadFiles:function(){return file.upLoadedFiles},clearUploadFiles:function(){file.upLoadedFiles=[]},cancelUpload:function(){return true},switchModel:function(a){if("1"==a){$("div.js_upload",$.pdialog.getCurrent()).addClass("hidden");$("div.js_uploaded",$.pdialog.getCurrent()).removeClass("hidden");$("div.js_scan",$.pdialog.getCurrent()).addClass("hidden");file.flashPic()}else{if("2"==a){$("div.js_upload",$.pdialog.getCurrent()).addClass("hidden");$("div.js_uploaded",$.pdialog.getCurrent()).addClass("hidden");$("div.js_scan",$.pdialog.getCurrent()).removeClass("hidden");setTimeout(scan.init,500)}else{$("div.js_upload",$.pdialog.getCurrent()).removeClass("hidden");$("div.js_uploaded",$.pdialog.getCurrent()).addClass("hidden");$("div.js_scan",$.pdialog.getCurrent()).addClass("hidden")}}},flashPic:function(){var b=file.getAllUploadFiles();var a=new Map();for(var c=0;c<b.length;c++){a.put(b[c].docId,b[c])}var d=$("select[name=sltDocTypeName]",$.pdialog.getCurrent()).val();$("div.js_uploaded span.js_pic_span",$.pdialog.getCurrent()).each(function(){var g=$(this);var e=g.attr("docId");var f=g.attr("docTypeName");if(d!=""){if(d==f){g.removeClass("hidden")}else{g.addClass("hidden")}}else{g.removeClass("hidden")}if(a.get(e)){g.find("input[type=checkbox]").attr("checked",true)}else{g.find("input[type=checkbox]").removeAttr("checked")}})},closeUpFile:function(){if(scan.isOpen){scan.closeScan()}scan.clearUploadFiles();file.clearUploadFiles();file.getDocTypeRelUrl=file.defaultDocTypeRelUrl;file.successCallBack=null}};var scan={upLoadedFiles:[],isOpen:false,sendUpload:function(){var $form=$("#scan001",$.pdialog.getCurrent());if($("input[name=upFile][value!='']",$.pdialog.getCurrent()).length==0){$.pdialog.closeCurrent()}else{if($form.valid()){var url=getGlobalPathRoot()+"oframe/common/file/file-upbase64.gv";var ajaxPacket=new AJAXPacket(url);var jsonData=$form.serializeArray();jsonData.push({name:"prjCd",value:getPrjCd()});ajaxPacket.data.data=jsonData;core.ajax.sendPacketHtml(ajaxPacket,function(response){var jsonData=eval("("+response+")");var isSuccess=jsonData.success;if(isSuccess){var fileArray=jsonData.data;for(var i=0;i<fileArray.length;i++){var tempFileItem={};tempFileItem.docId=jsonData.data[i].docId;tempFileItem.fileName=jsonData.data[i].docName;tempFileItem.docPath=jsonData.data[i].docPath;scan.upLoadedFiles.push(tempFileItem)}$.pdialog.closeCurrent()}else{alert(jsonData.errMsg)}})}}},init:function(){if(scan.isOpen){return}if(!isIE()){alert("文档扫描只支持IE浏览器，请使用IE浏览器！");return}Capture=$("#ScanCapture",$.pdialog.getCurrent())[0];if(!Capture){return}var b=parseInt($("input[name=deviceIdx]",$.pdialog.getCurrent()).val());var a=Capture.OpenDevice(b);if(a==0){scan.isOpen=true;Capture.SetJPGQuality(70);scan.cutType(parseInt($("input[name=cutType]",$.pdialog.getCurrent()).val()));scan.changeRotation(90);scan.changeDpi(200)}else{alertMsg.error("镜头打开失败！错误编码："+a)}},closeScan:function(){if(!scan.isOpen){return true}var b=scan.getCurrentDeviceIdx();var a=0;if(!scan.isDigit(b)){Capture.CloseDeviceEx()}else{a=Capture.CloseDeviceEx()}if(a!=0){alertMsg.error("镜头关闭失败!错误编码："+a)}else{Capture=null;scan.isOpen=false}return true},isDigit:function(b){var a=/^-?\d+(\.\d+)?$/;if(!a.exec(b)){return false}return true},changeScan:function(){if(!scan.isOpen){alertMsg.error("镜头打开失败！");return}var a=parseInt($("input[name=deviceIdx]",$.pdialog.getCurrent()).val());Capture.ShowDevicePages(a)},resetScan:function(){scan.closeScan();scan.init()},getCurrentDeviceIdx:function(){return parseInt($("input[name=deviceIdx]",$.pdialog.getCurrent()).val())},changeDevice:function(){if(!scan.isOpen){alertMsg.error("镜头打开失败！");return}var b=parseInt($("input[name=deviceIdx]",$.pdialog.getCurrent()).val());if(b==0){b=1}else{b=0}var a=Capture.CloseDeviceEx();if(a!=0){alertMsg.error("镜头关闭失败！错误编码："+a)}scan.isOpen=false;$("input[name=deviceIdx]",$.pdialog.getCurrent()).val(b);scan.init()},changeColorMode:function(){if(!scan.isOpen){alertMsg.error("镜头打开失败！");return}var b=parseInt($("input[name=deviceIdx]",$.pdialog.getCurrent()).val());var a=parseInt($("input[name=colorMode]",$.pdialog.getCurrent()).val());a++;if(a>2){a=0}if(Capture.SetColorMode(a)==0){$("input[name=colorMode]",$.pdialog.getCurrent()).val(a);scan.flashText()}},changeCutType:function(){if(!scan.isOpen){alertMsg.error("镜头打开失败！");return}var b=parseInt($("input[name=deviceIdx]",$.pdialog.getCurrent()).val());var a=parseInt($("input[name=cutType]",$.pdialog.getCurrent()).val());a++;if(a>2){a=0}scan.cutType(a)},changeDpi:function(a){if(!scan.isOpen){alertMsg.error("镜头打开失败！");return}var c=parseInt($("input[name=deviceIdx]",$.pdialog.getCurrent()).val());if(Capture.OpenDevice(c)!=1){return}if(Capture.OpenDevice(c)==1){if(a==""){alertMsg.error("DPI值都不能为空！");return}if(scan.isDigit(a)){var b=parseInt(a);if(Capture.SetGrabbedDPIEx(b)!=0){alertMsg.error("DPI设置失败")}else{scan.flashText()}}else{alertMsg.error("含有非法字符，请重新输入数字！")}}else{alertMsg.error("找不到设备或打开失败！")}},changeRotation:function(b){if(!scan.isOpen){alertMsg.error("镜头打开失败！");return}var c=parseInt($("input[name=deviceIdx]",$.pdialog.getCurrent()).val());var d=parseInt(b);if(d%90!=0){Capture.SetDeviceRotate(c,0)}var a=Capture.SetDeviceRotate(c,d);if(a!=0){alertMsg.error("旋转镜头失败")}},catchPic:function(){if(!scan.isOpen){alertMsg.error("镜头打开失败！");return}var b=$("input[name=fileDir]",$.pdialog.getCurrent()).val();var d=(new Date()).getTime()+".jpg";var a=b+d;var c=Capture.GetBase64String();scan.addPreview(c,d)},cutType:function(c){if(!scan.isOpen){alertMsg.error("镜头打开失败！");return}var b=parseInt($("input[name=deviceIdx]",$.pdialog.getCurrent()).val());var a;if(c==0){a=Capture.SetCutPageType(b,0)}else{if(c==1){a=Capture.SetCutPageType(b,1)}else{if(c==2){a=Capture.SetCutPageType(b,2)}else{a=Capture.SetCutPageType(b,0)}}}if(a==0){$("input[name=cutType]",$.pdialog.getCurrent()).val(c);scan.flashText()}else{alertMsg.error("切边模式切换失败!")}},addPreview:function(d,h){var g=$("#picUl",$.pdialog.getCurrent());var a=$("li.hidden",g);var c=$("#scanTemplate",$.pdialog.getCurrent());var b=a.clone().append(c.html());var e=$("img",b);var f=h.substring(h.lastIndexOf(".")+1).toLowerCase();if(f!="png"&&f!="jpg"&&f!="bmp"&&f!="tif"){alertMsg.error("文件必须为图片！");return}if(document.all){e.attr("src","data:image/jpeg;base64,"+d);e.attr("realSrc","data:image/jpeg;base64,"+d)}$("input[name=fileName]",b).val(h).addClass("required");$("input[name=upFile]",b).val(d);g.append(b);b.removeClass("hidden")},flashText:function(){var d=parseInt($("input[name=deviceIdx]",$.pdialog.getCurrent()).val());var a=$("ul.js_scan_menu");if(d==0){$("span.deviceType",a).html("[文档镜头]")}else{if(d==1){$("span.deviceType",a).html("[人像镜头]")}else{$("span.deviceType",a).html("")}}var b=parseInt($("input[name=cutType]",$.pdialog.getCurrent()).val());if(b==0){$("span.cutType",a).html("[不切边]")}else{if(b==1){$("span.cutType",a).html("[自动切边]")}else{if(b==2){$("span.cutType",a).html("[自定义切边]")}else{$("span.cutType",a).html("")}}}var c=parseInt($("input[name=colorMode]",$.pdialog.getCurrent()).val());if(c==0){$("span.colorMode",a).html("[彩色]")}else{if(c==1){$("span.colorMode",a).html("[灰度]")}else{if(c==2){$("span.colorMode",a).html("[黑白]")}else{$("span.colorMode",a).html("")}}}},removePic:function(a){$(a).parent().parent().remove()},getUploadFiles:function(){return scan.upLoadedFiles},clearUploadFiles:function(){scan.upLoadedFiles=[];scan.isOpen=false}};var FileViewer={closeFunc:null};var ImgPage={viewPicWithSlfUrl:function(f,c,b){var a=getGlobalPathRoot()+"oframe/common/file/file-view.gv";var e=new AJAXPacket(a);e.data.add("imgBaseUrl",f);e.data.add("docIds",c);if(b){for(var d in b){e.data.add(d,b[d])}}core.ajax.sendPacketHtml(e,function(g){navTab.getCurrentPanel().append($(g));FileViewer.closeFunc=function(){}})},viewPic:function(c){var b=$(c).attr("docId");if(b){var a=getGlobalPathRoot()+"oframe/common/file/file-view.gv";var d=new AJAXPacket(a);d.data.add("docIds",b);d.data.add("canDel","false");core.ajax.sendPacketHtml(d,function(e){navTab.getCurrentPanel().append($(e));FileViewer.closeFunc=function(){}})}},viewPics:function(d,a){var b=getGlobalPathRoot()+"oframe/common/file/file-view.gv";var c=new AJAXPacket(b);c.data.add("docIds",d);c.data.add("currentDocId",a);c.data.add("canDel","false");core.ajax.sendPacketHtml(c,function(e){navTab.getCurrentPanel().append($(e));FileViewer.closeFunc=function(){}})},viewPicsDiag:function(f,a){if(!f){f=""}if(!a){a=""}var b=getGlobalPathRoot()+"oframe/common/file/file-view.gv?canDel=false&dialogFlag=true&currentDocId="+a+"&docIds="+f;var c=$(window).width()*0.6;var g=$(window).height()-100;if(isIE()){window.showModelessDialog(b,"附件浏览","dialogWidth="+c+"px;dialogHeight="+g+"px;status=no;help=no;scrollbars=no")}else{var e=(window.screen.availHeight-30-g)/2;var d=(window.screen.availWidth-10-c)/2;window.open(b,"附件浏览","height="+g+", width="+c+", top="+e+", left="+d)}},keyJump:function(a){var b=null;if(navigator.appname=="Netscape"){b=a.which}else{b=a.keyCode}if(b==38){if(!$("#imgDialog #rotRight").is(":hidden")){$("#imgDialog #rotRight").click()}stopEvent(a)}else{if(b==39){if(!$("#imgDialog div.btnRight").is(":hidden")){$("#imgDialog div.btnRight").click()}stopEvent(a)}else{if(b==37){if(!$("#imgDialog div.btnLeft").is(":hidden")){$("#imgDialog div.btnLeft").click()}stopEvent(a)}else{if(b==40){if(!$("#imgDialog #rotLeft").is(":hidden")){$("#imgDialog #rotLeft").click()}stopEvent(a)}}}}}};var upFile={uploadLoadFileClosed:function(b){var g=file.getUploadFiles();if(file.uploadSuccess){var h=b.divId;var j=$("#"+h).find("label.hidden");for(var f=0;f<g.length;f++){var d=g[f];var e=j.clone();var a=getGlobalPathRoot()+"oframe/common/file/file-download.gv?docId="+d.docId;var k=a;var c=d.fileName;if(!c.isImg()){k=getGlobalPathRoot()+"oframe/themes/images/word.png"}$(e).find("img").attr("src",k).attr("realSrc",k).attr("title",c);$(e).find("input[name=docId]").val(d.docId);$(e).find("input[name=docName]").val(c);$(e).find("input[name=docTypeName]").val($("#"+h).attr("docTypeName"));$(e).find("a").attr("href",a).attr("title",c).find("span").html(c);$(e).removeClass("hidden");$("#"+h).append(e)}}return true},openUploadFile:function(a){var c=$(a).closest("div.drag").attr("id");var b=getGlobalPathRoot()+"oframe/common/file/file-init.gv?docTypeName="+$("#"+c).attr("docTypeName")+"&relType="+$("#"+c).attr("relType")+"&relId="+$("#"+c).attr("relId");$.pdialog.open(b,"file","附件上传",{mask:true,close:upFile.uploadLoadFileClosed,param:{divId:c}})},isDigit:function(b){var a=/^-?\d+(\.\d+)?$/;if(!a.exec(b)){return false}return true},closeScan:function(b){if(!isIE()){return true}if(Capture==null&&b==null){return true}if(typeof(Capture)=="undefined"||typeof(scan)=="undefined"){return true}var h=scan.getCurrentDeviceIdx();var m;if(Capture!=null&&Capture.CloseDeviceEx&&$.isFunction(Capture.CloseDeviceEx)){Capture.CloseDeviceEx()}if(m!=0){alertMsg.error("镜头关闭失败!")}else{Capture=null}var g=scan.getUploadFiles();var j=b.divId;var k=$("#"+j).find("label.hidden");for(var f=0;f<g.length;f++){var e=g[f];var d=k.clone();var a=getGlobalPathRoot()+"oframe/common/file/file-download.gv?docId="+e.docId;var l=a;var c=e.fileName;if(!c.isImg()){l=getGlobalPathRoot()+"oframe/themes/images/word.png"}$(d).find("img").attr("src",l).attr("realSrc",l).attr("title",c);$(d).find("input[name=docId]").val(e.docId);$(d).find("input[name=docName]").val(c);$(d).find("input[name=docTypeName]").val($("#"+j).attr("docTypeName"));$(d).find("a").attr("href",a).attr("title",c).find("span").html(c);$(d).removeClass("hidden");$("#"+j).append(d)}return true},openScanPage:function(a){var c=$(a).closest("div.drag").attr("id");var b=getGlobalPathRoot()+"oframe/common/file/file-scan.gv?docTypeName="+$("#"+c).attr("docTypeName")+"&relType="+$("#"+c).attr("relType")+"&relId="+$("#"+c).attr("relId");$.pdialog.open(b,"file","文档扫描",{mask:true,max:true,close:upFile.closeScan,param:{divId:c}})},dropFile:function(h,c){var b=$(c).closest("div.drag").attr("id");if(typeof FileReader=="undefined"){alertMsg.warn("您的浏览器不支持拖拽上传")}var g=h.dataTransfer.files;var e=new FormData();for(var d=0;d<g.length;d++){var f=g[d];var a=new FileReader();a.readAsDataURL(f);a.onload=(function(j){return function(k){}})(f);e.append($("#"+b).attr("docTypeName"),f)}e.append("relType",$("#"+b).attr("relType"));e.append("relId",$("#"+b).attr("relId"));e.append("prjCd",getPrjCd());upFile.sendFileToServer(e,b);stopEvent()},sendFileToServer:function(formData,divId){var uploadURL=getGlobalPathRoot()+"oframe/common/file/file-upload.gv";var extraData={};var jqXHR=$.ajax({xhr:function(){var xhrObj=$.ajaxSettings.xhr();return xhrObj},url:uploadURL,type:"POST",contentType:false,processData:false,cache:false,data:formData,success:function(data){var jsonData=eval("("+data+")");if(jsonData.success){var hiddenSpan=$("#"+divId).find("label.hidden");for(var i=0;i<jsonData.data.length;i++){var uploadedFile=jsonData.data[i];var newSpan=hiddenSpan.clone();var downLoadUrl=getGlobalPathRoot()+"oframe/common/file/file-download.gv?docId="+uploadedFile.docId;var imgSrc=downLoadUrl;var fileName=uploadedFile.docName;if(!fileName.isImg()){imgSrc=getGlobalPathRoot()+"oframe/themes/images/word.png"}$(newSpan).find("img").attr("src",imgSrc).attr("realSrc",imgSrc).attr("title",fileName);$(newSpan).find("input[name=docId]").val(uploadedFile.docId);$(newSpan).find("input[name=docName]").val(fileName);$(newSpan).find("input[name=docTypeName]").val($("#"+divId).attr("docTypeName"));$(newSpan).find("a").attr("href",downLoadUrl).attr("title",fileName).find("span").html(fileName);$(newSpan).removeClass("hidden");$("#"+divId).append(newSpan)}}else{alertMsg.warn(jsonData.errMsg)}}})},removeFile:function(obj){var packet=new AJAXPacket();packet.url=$(obj).attr("href");core.ajax.sendPacketHtml(packet,function(response){var jsonData=eval("("+response+")");if(jsonData.success){$(obj).parent().remove()}else{}})}};var LeftMenu={init:function(d,f,c,a){if(!c){c={}}var h=c.cookieName;var b=c.clickCallBack;var e=$("#"+d,navTab.getCurrentPanel());var g=$("#"+f,navTab.getCurrentPanel());$("div.split_line",navTab.getCurrentPanel()).mousedown(function(j){$("div.split_line",navTab.getCurrentPanel()).jDrag({scop:true,cellMinW:20,move:"horizontal",event:j,stop:function(k){var m=$(k).position().left;if(a&&m<=40){e.width("40")}else{e.width($(k).position().left)}g.css("margin-left",(m+10)+"px");var l=$("div.j-resizeGrid",navTab.getCurrentPanel());if(l.length>0){l.each(function(){$(this).jResize()})}$(k).css("left",0);if(b&&$.isFunction(b)){b({})}}})});$("span.split_but",navTab.getCurrentPanel()).mousedown(function(j){stopEvent(j)});$("span.split_but",navTab.getCurrentPanel()).click(function(o){var n=$(this).parent();var p=n.prev("div.left_menu");var j=p.attr("class").indexOf("menu_left");var l=false;if(j!=-1){l=true}else{l=false}if(p.is(":visible")){var k="false";if(a){if(l){p.removeClass("menu_left");n.removeClass("menu_hide");g.css("margin-left",p.width()+10+"px");k="true"}else{p.addClass("menu_left");n.addClass("menu_hide");g.css("margin-left","50px");k="false"}}else{p.hide();n.addClass("menu_hide");g.css("margin-left","10px")}if(h){setPCookie(h,k,"/")}if(b&&$.isFunction(b)){b({})}}else{p.show();n.removeClass("menu_hide");g.css("margin-left",p.width()+10+"px");if(h){setPCookie(h,"true","/")}if(b&&$.isFunction(b)){b({})}}var m=$("div.j-resizeGrid",navTab.getCurrentPanel());if(m.length>0){m.each(function(){$(this).jResize()})}});if(h&&"false"==$.cookie(h)){$("span.split_but",navTab.getCurrentPanel()).trigger("click")}}};var table={addRow:function(e,f){var d=$("#"+e);var c=d.find("tr:eq(1)");var a=$(c).clone().removeClass("hidden");if(f){var b=d.find("tr").index($(f).parent().parent());if(b==0){$(c).after(a)}else{$(f).parent().parent().after(a)}}else{d.append(a)}$(a).initUI();return a},addRowNoInit:function(e,f){var d=$("#"+e);var c=d.find("tr:eq(1)");var a=$(c).clone().removeClass("hidden");if(f){var b=d.find("tr").index($(f).parent().parent());if(b==0){d.append(a)}else{$(f).parent().parent().after(a)}}else{d.append(a)}return a},deleteRow:function(a){$(a).closest("tr").remove()},upRow:function(c,d){var a=$("#"+c).find("tr").index($(d).parent().parent());if(a==2){}else{var b=$(d).parent().parent();$(b).prev().before($(b))}},downRow:function(c,d){var a=$("#"+c).find("tr").index($(d).parent().parent());if(a==1){}else{var b=$(d).parent().parent();$(b).next().after($(b))}}};var CheckUtil={checkNum:function(a){return a.match(/\D/)==null},checkDecimal:function(a){if(a.match(/^-?\d+(\.\d+)?$/g)==null){return false}else{return true}},checkHouseSize:function(a){if(a.match(/^\d+(\.\d\d)$/g)==null){return false}else{return true}},checkInteger:function(a){if(a.match(/^[-+]?\d*$/)==null){return false}else{return true}},checkStr:function(a){if(/[^\x00-\xff]/g.test(a)){return false}else{return true}},checkChinese:function(a){if(escape(a).indexOf("%u")!=-1){return true}else{return false}},checkEmail:function(a){if(a.match(/[A-Za-z0-9_-]+[@](\S*)(net|com|cn|org|cc|tv|[0-9]{1,3})(\S*)/g)==null){return false}else{return true}},checkMobilePhone:function(a){if(a.match(/^1[3|4|5|7|8][0-9]\d{8}$/)==null){return false}else{return true}},checkTelephone:function(a){if(a.match(/^(([0\+]\d{2,3}-)?(0\d{2,3})-)(\d{7,8})(-(\d{3,}))?$/)==null){return false}else{return true}},checkQQ:function(a){if(a.match(/^\d{5,10}$/)==null){return false}else{return true}},checkCard:function(c){var b=/^[1-9]\d{7}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}$/;var a=/^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])((\d{4})|\d{3}[A-Z])$/;if(c.match(b)==null&&c.match(a)==null){return false}else{return true}},checkIP:function(b){var a=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;if(b.match(a)==null){return false}else{return true}},checkURL:function(a){if(a.match(/(http[s]?|ftp):\/\/[^\/\.]+?\..+\w$/i)==null){return false}else{return true}},checkQuote:function(c){var a=new Array("~","`","!","@","#","$","%","^","&","*","{","}","[","]","(",")");a.push(":",";","'","|","\\","<",">","?","/","<<",">>","||","//");a.push("admin","administrators","administrator","管理员","系统管理员");a.push("select","delete","update","insert","create","drop","alter","trancate");c=c.toLowerCase();for(var b=0;b<a.length;b++){if(c.indexOf(a[b])>=0){return true}}return false},checkDate:function(c){var b=c.match(/^(\d{1,4})(-|\/)(\d{1,2})\2(\d{1,2})$/);if(b==null){return false}else{var a=new Date(b[1],b[3]-1,b[4]);return(a.getFullYear()==b[1]&&(a.getMonth()+1)==b[3]&&a.getDate()==b[4])}},checkTime:function(b){var a=b.match(/^(\d{1,2})(:)?(\d{1,2})\2(\d{1,2})$/);if(a==null){return false}else{if(a[1]>24||a[3]>60||a[4]>60){return false}else{return true}}},checkFullTime:function(b){var a=b.match(/^(?:19|20)[0-9][0-9]-(?:(?:0[1-9])|(?:1[0-2]))-(?:(?:[0-2][1-9])|(?:[1-3][0-1])) (?:(?:[0-2][0-3])|(?:[0-1][0-9])):[0-5][0-9]:[0-5][0-9]$/);if(a==null){return false}else{return true}},Wi:[7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2,1],ValideCode:[1,0,10,9,8,7,6,5,4,3,2],IdCardValidate:function(a){a=CheckUtil.trim(a.replace(/ /g,""));if(a.length==15){return CheckUtil.isValidityBrithBy15IdCard(a)}else{if(a.length==18){var b=a.split("");if(CheckUtil.isValidityBrithBy18IdCard(a)&&CheckUtil.isTrueValidateCodeBy18IdCard(b)){return true}else{return false}}else{return false}}},isTrueValidateCodeBy18IdCard:function(a){var c=0;if(a[17].toLowerCase()=="x"){a[17]=10}for(var b=0;b<17;b++){c+=CheckUtil.Wi[b]*a[b]}valCodePosition=c%11;if(a[17]==CheckUtil.ValideCode[valCodePosition]){return true}else{return false}},maleOrFemalByIdCard:function(a){a=trim(a.replace(/ /g,""));if(a.length==15){if(a.substring(14,15)%2==0){return"female"}else{return"male"}}else{if(a.length==18){if(a.substring(14,17)%2==0){return"female"}else{return"male"}}else{return null}}},isValidityBrithBy18IdCard:function(b){var d=b.substring(6,10);var e=b.substring(10,12);var a=b.substring(12,14);var c=new Date(d,parseFloat(e)-1,parseFloat(a));if(c.getFullYear()!=parseFloat(d)||c.getMonth()!=parseFloat(e)-1||c.getDate()!=parseFloat(a)){return false}else{return true}},isValidityBrithBy15IdCard:function(d){var c=d.substring(6,8);var e=d.substring(8,10);var a=d.substring(10,12);var b=new Date(c,parseFloat(e)-1,parseFloat(a));if(b.getYear()!=parseFloat(c)||b.getMonth()!=parseFloat(e)-1||b.getDate()!=parseFloat(a)){return false}else{return true}},trim:function(a){return a.replace(/(^\s*)|(\s*$)/g,"")}};var tree={slfClickNode:null,slfCfmSlt:null,getAjaxPacket:null,isCheckEnable:function(){var a=$("#treeCheck").val();if(a&&a!=""){return true}else{return false}},initFullTree:function(){var packet=null;if(tree.getAjaxPacket){packet=tree.getAjaxPacket()}else{packet=new AJAXPacket();packet.url=getGlobalPathRoot()+$("#treeData").val()}core.ajax.sendPacketHtml(packet,function(response){var jsonData=eval("("+response+")");var treeJson=jsonData.resultMap.treeJson;var isSuccess=jsonData.success;if(isSuccess){var pjOrgTreeSetting={data:{simpleData:{enable:true}},callback:{onClick:tree.clickNode,onCheck:tree.checkNode},check:{autoCheckTrigger:false,enable:tree.isCheckEnable(),chkStyle:"checkbox",chkboxType:{Y:"",N:""}}};var zTree=$.fn.zTree.init($("#commonTreeContent"),pjOrgTreeSetting,treeJson)}else{alertMsg.warn(jsonData.data.errMsg)}},true,false)},clickNode:function(d,f,e){if(tree.isCheckEnable()){return false}else{if(tree.slfClickNode){if(tree.slfClickNode(e)){tree.closeTree()}}else{var g=$("#openTip",$.pdialog.getCurrent());if(g.length==0){g=$("#openTip",navTab.getCurrentPanel())}var a=g.data("clickObj");var c=$(a).parent();$(c).find("input[type=hidden]").val(e.id);$(c).find("input[type=text]").val(e.name);var b=$("input[name=fromOp]",g).val();tree.closeTree()}}},checkNode:function(c,e,d){if(tree.slfClickNode){tree.slfClickNode(c,e,d)}var b=$.fn.zTree.getZTreeObj(e);var a=d.getParentNode();if(a){tree.checkAllParent(b,a,false)}var f=d.children;tree.checkAllSub(b,f,false)},checkAllParent:function(b,c,a){b.checkNode(c,a,true);if(c.getParentNode()){tree.checkAllParent(b,c.getParentNode(),a)}},checkAllSub:function(c,d,b){if(d){for(var a=0;a<d.length;a++){var e=d[a];c.checkNode(e,b,true);tree.checkAllSub(c,e.children,b)}}},onCfmSlt:function(d){var c=$.fn.zTree.getZTreeObj("commonTreeContent");var b=c.getCheckedNodes(true);if(tree.slfCfmSlt){tree.slfCfmSlt(b)}else{var a=[];var f=[];for(var e=0;e<b.length;e++){a.push(b[e].id);f.push(b[e].name)}var g=$("#openTip",$.pdialog.getCurrent());if(g.length==0){g=$("#openTip",navTab.getCurrentPanel())}var k=g.data("clickObj");var h=$(k).parent();$(h).find("input[type=hidden]").val(a.join(","));$(h).find("input[type=text]").val(f.join(","));var j=$("input[name=fromOp]",g).val();tree.closeTree()}tree.closeTree()},closeTree:function(){$("#openTip",$.pdialog.getCurrent()).remove();$("#openTip",navTab.getCurrentPanel()).remove();tree.getAjaxPacket=null;tree.slfClickNode=null;tree.slfCfmSlt=null}};var CODE={getCfgDataOptWithFilter:function(obj){return{processData:function(result){var myData=[];for(i=0;i<result.length;i++){var dataRow={};dataRow.data=result[i];dataRow.value=result[i].value;myData.push(dataRow)}return myData},showResult:function(value,data){return data.value},displayValue:function(value,data){return data.value},remoteDataType:"json",delay:300,minChars:0,sortResults:false,filterResults:true,onItemSelect:function(obj){var data=obj.data;var source=$(obj.source);var $td=source.closest("td");$("input[type=hidden]",$td).val(data.key)},onNoMatch:function(obj){var source=$(obj.source);var $td=source.closest("td");var mustMatch=source.attr("mustMatch");if(!"false"==mustMatch){source.val("")}$("input[type=hidden]",$td).val("")},fetchData:function(obj){var resultData={};var $td=$(obj).closest("td");var attrRelItemCd=$(obj).attr("itemCd");if(attrRelItemCd&&attrRelItemCd!=""){var url=getGlobalPathRoot()+"oframe/sysmg/sys005/sys005-data.gv?";var ajaxPacket=new AJAXPacket(url);ajaxPacket.data.add("itemCd",attrRelItemCd);ajaxPacket.data.add("prjCd",getPrjCd());core.ajax.sendPacketHtml(ajaxPacket,function(response){resultData=eval("("+response+")")},false)}return resultData}}},getCfgDataOpt:function(obj){return{processData:function(result){var myData=[];for(i=0;i<result.length;i++){var dataRow={};dataRow.data=result[i];dataRow.value=result[i].value;myData.push(dataRow)}return myData},showResult:function(value,data){return data.value},displayValue:function(value,data){return data.value},remoteDataType:"json",delay:300,minChars:0,sortResults:false,filterResults:false,onItemSelect:function(obj){var data=obj.data;var source=$(obj.source);var $td=source.closest("td");$("input[type=hidden]",$td).val(data.key)},onNoMatch:function(obj){var source=$(obj.source);var $td=source.closest("td");var mustMatch=source.attr("mustMatch");if(!"false"==mustMatch){source.val("")}$("input[type=hidden]",$td).val("")},fetchData:function(obj){var resultData={};var $td=$(obj).closest("td");var attrRelItemCd=$(obj).attr("itemCd");if(attrRelItemCd&&attrRelItemCd!=""){var url=getGlobalPathRoot()+"oframe/sysmg/sys005/sys005-data.gv?";var ajaxPacket=new AJAXPacket(url);ajaxPacket.data.add("itemCd",attrRelItemCd);ajaxPacket.data.add("prjCd",getPrjCd());core.ajax.sendPacketHtml(ajaxPacket,function(response){resultData=eval("("+response+")")},false)}return resultData}}},getStaffOpt:function(obj){return{processData:function(result){var myData=[];for(i=0;i<result.length;i++){var dataRow={};dataRow.data=result[i];dataRow.value=result[i].value;myData.push(dataRow)}return myData},showResult:function(value,data){return data.value},displayValue:function(value,data){return data.value},remoteDataType:"json",delay:300,minChars:0,filterResults:false,onItemSelect:function(obj){var data=obj.data;var source=$(obj.source);var $td=source.closest("td");$("input[type=hidden]",$td).val(data.key)},onNoMatch:function(obj){var source=$(obj.source);var $td=source.closest("td");source.val("");$("input[type=hidden]",$td).val("")},fetchData:function(obj){var resultData={};var $td=$(obj).closest("td");var staffName=$(obj).val();var url=getGlobalPathRoot()+"oframe/sysmg/sys002/sys002-queryStaff.gv?";var ajaxPacket=new AJAXPacket(url);ajaxPacket.data.add("staffName",staffName);ajaxPacket.data.add("prjCd",getPrjCd());core.ajax.sendPacketHtml(ajaxPacket,function(response){resultData=eval("("+response+")")},false);return resultData}}}};var EMap={getMapInitData:null,cfmDraCallBack:null,initData:function(){var a=[];if($.isFunction(EMap.getMapInitData)){a=EMap.getMapInitData()}return a},calcPointsCenter:function(m){if(m!=undefined&&m!=""&&m!=null){var g=m.split("|");var k=[];var h=[];var c=[];for(var e=0;e<g.length;e++){k=g[e].split(",");var a=[];for(var d=0;d<k.length;d++){var f=k[d].replace("POINT(","").replace(")","").split(" ");h.push(f[0]);c.push(f[1]);a.push(new OpenLayers.Geometry.Point(f[0],f[1]))}}var b=(Math.max.apply(null,h)+Math.min.apply(null,h))/2;var l=(Math.max.apply(null,c)+Math.min.apply(null,c))/2;lon=b;lat=l;return[b,l]}else{return[501546,301055]}},cfmDraw:function(b){var a=true;if($.isFunction(EMap.cfmDraCallBack)){a=EMap.cfmDraCallBack(b)}return a}};(function(a){this.version="(beta)(0.0.3)";this.all={};this.special_keys={27:"esc",9:"tab",32:"space",13:"return",8:"backspace",145:"scroll",20:"capslock",144:"numlock",19:"pause",45:"insert",36:"home",46:"del",35:"end",33:"pageup",34:"pagedown",37:"left",38:"up",39:"right",40:"down",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12"};this.shift_nums={"`":"~","1":"!","2":"@","3":"#","4":"$","5":"%","6":"^","7":"&","8":"*","9":"(","0":")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|"};this.add=function(h,d,b){if(a.isFunction(d)){b=d;d={}}var e={},f={type:"keydown",propagate:false,disableInInput:true,target:"html"},c=this,e=a.extend(e,f,d||{});h=h.toLowerCase();var g=function(o){o=a.event.fix(o);var m=o.data.selector,t=a(o.target);var s=o.which,l=o.type,j=String.fromCharCode(s).toLowerCase(),k=c.special_keys[s],q=o.shiftKey,p=o.ctrlKey,v=o.altKey,n=true,w=null,u=c.all[m].events[l].callbackMap;if(e.disableInInput&&t.is("textarea, input")&&!(v||p||q)){return}if(!q&&!p&&!v){w=u[k]||u[j]}else{var r="";if(v){r+="alt+"}if(p){r+="ctrl+"}if(q){r+="shift+"}w=u[r+k]||u[r+j]||u[r+c.shift_nums[j]]}if(w){w.cb(o);if(!w.propagate){o.stopPropagation();o.preventDefault();return false}}};if(!this.all[e.target]){this.all[e.target]={events:{}}}if(!this.all[e.target].events[e.type]){this.all[e.target].events[e.type]={callbackMap:{}};a(e.target).bind(e.type,{selector:e.target},g)}this.all[e.target].events[e.type].callbackMap[h]={cb:b,propagate:e.propagate};return a};this.remove=function(c,b){b=b||{};target=b.target||"html";type=b.type||"keydown";c=c.toLowerCase();a(target).unbind(type);delete this.all[target].events[type].callbackMap[c];return a};a.hotkeys=this;return a})(jQuery);(function(a){a.fn.sltOrg=function(f,d){var c=getGlobalPathRoot()+"oframe/sysmg/sys004/sys004-initTree.gv";var b=a(f).prev("input[type=text]");var e={href:c,height:"230",offsetY:31,relObj:b};if(d){e=a.extend(e,d)}if(!e.width&&e.relObj.length>0){e.width=e.relObj.width()+24}if((typeof(e.args)==="undefined")||(typeof(e.args.orgPrjCd)==="undefined")){e.args={orgPrjCd:getPrjCd()}}a(f).openTip(e)};a.fn.sltReg=function(g,e){var d={treeType:1,fromOp:""};if(e){a.extend(d,e)}var c=getGlobalPathRoot()+"eland/pj/pj004/pj004-initTree.gv?treeType="+d.treeType+"&fromOp="+d.fromOp;var b=a(g).prev("input[type=text]");var f={href:c,height:"230",offsetY:31,relObj:b};if(e){f=a.extend(f,e)}if(!f.width&&f.relObj.length>0){f.width=f.relObj.width()+24}a(g).openTip(f)};a.fn.sltStaff=function(g,e){var d={fromOp:""};if(e){a.extend(d,e)}var c=getGlobalPathRoot()+"oframe/sysmg/sys004/sys004-initStaffTree.gv?fromOp="+d.fromOp;if(e.prjCd){c+="&staffPrjCd="+e.prjCd}var b=a(g).prev("input[type=text]");var f={href:c,height:"230",relObj:b,appendBody:true};if(e){f=a.extend(f,e)}if(!f.width&&f.relObj.length>0){f.width=f.relObj.width()+24}a(g).openTip(f)};a.fn.sltRole=function(g,e){var d={fromOp:""};if(e){a.extend(d,e)}var c=getGlobalPathRoot()+"oframe/sysmg/sys004/sys004-initRole.gv?fromOp="+d.fromOp;if(e.prjCd){c+="&staffPrjCd="+e.prjCd}var b=a(g).prev("input[type=text]");var f={href:c,height:"230",relObj:b,appendBody:true};if(e){f=a.extend(f,e)}if(!f.width&&f.relObj.length>0){f.width=f.relObj.width()+24}a(g).openTip(f)};a.fn.sltCode=function(g,e){var d={fromOp:""};if(e){a.extend(d,e)}var c=getGlobalPathRoot()+"oframe/common/tree/tree-code.gv?fromOp="+d.fromOp+"&itemCd="+d.itemCd+"&sltData="+d.sltData+"&treeCheck="+d.treeCheck;if(e.prjCd){c+="&staffPrjCd="+e.prjCd}var b=a(g).prev("input[type=text]");var f={href:c,height:"230",relObj:b,appendBody:true};if(e){f=a.extend(f,e)}if(!f.width&&f.relObj.length>0){f.width=f.relObj.width()+24}a(g).openTip(f)}})(jQuery);(function(a){if(isIE()){if(window.console){console.log("\u56db\u6d77\u5bcc\u535a\u0020\u6b22\u8fce\u4f60");console.log("\u5982\u679c\u4f60\u4e5f\u559c\u6b22\u94bb\u7814\u0077\u0065\u0062\u6280\u672f\u90a3\u5c31\u52a0\u5165\u6211\u4eec\u5427\uff01\u0020\u0068\u0074\u0074\u0070\u003a\u002f\u002f\u0077\u0077\u0077\u002e\u0062\u006a\u0073\u0068\u0066\u0062\u002e\u0063\u006f\u006d\u002f");console.log("\u53d1\u9001\u7b80\u5386\u5230\uff1a\u0062\u006a\u0073\u0068\u0066\u0062\u0040\u0031\u0032\u0036\u002e\u0063\u006f\u006d")}}else{console.log("%c \u56db\u6d77\u5bcc\u535a\u0020\u6b22\u8fce\u4f60","font-size:40px;color:blue;-webkit-text-fill-color:blue;-webkit-text-stroke: 1px blue;");console.log("%c \u5982\u679c\u4f60\u4e5f\u559c\u6b22\u94bb\u7814\u0077\u0065\u0062\u6280\u672f\u90a3\u5c31\u52a0\u5165\u6211\u4eec\u5427\uff01\u0020\u0068\u0074\u0074\u0070\u003a\u002f\u002f\u0077\u0077\u0077\u002e\u0062\u006a\u0073\u0068\u0066\u0062\u002e\u0063\u006f\u006d\u002f\u0073\u0068\u0066\u0062\u002f\u0070\u006f\u0072\u0074\u0061\u006c\u002f\u0073\u0068\u0066\u0062\u002d\u0064\u0065\u0074\u0061\u0069\u006c\u002e\u0067\u0076\u003f\u0072\u0068\u0074\u0049\u0064\u003d\u0033\u0032\u0030\u0036\u0026\u0066\u0069\u0072\u0073\u0074\u004c\u0065\u0076\u0065\u006c\u003d\u0036\u0026\u0070\u0075\u0062\u0049\u0064\u003d\u0034\u0035\u0033\u0033","font-size: 14px;color:#333");console.log("%c \u53d1\u9001\u7b80\u5386\u5230\uff1a\u0062\u006a\u0073\u0068\u0066\u0062\u0040\u0031\u0032\u0036\u002e\u0063\u006f\u006d","font-size: 14px;color:#333")}function b(g){var j=g||window.event;var f=j.target||j.srcElement;var m=f.type||f.getAttribute("type");var h=f.getAttribute("readonly");var k=f.getAttribute("enabled");var l=f.getAttribute("contenteditable");if(l=="true"){return true}h=(h==null)?false:h;k=(k==null)?true:k;var d=(j.keyCode==8&&(m=="password"||m=="text"||m=="textarea")&&(h==true||k!=true))?true:false;var c=(j.keyCode==8&&m!="password"&&m!="text"&&m!="textarea")?true:false;if(c){return false}if(d){return false}}document.onkeypress=b;document.onkeydown=b})(jQuery);var divId="dataList";var Query={getDivObj:function(c){var b=$("#"+c,navTab.getCurrentPanel());if($.pdialog.getCurrent()){var a=$("#"+c,$.pdialog.getCurrent());if(a.length>0){b=a}}return b},queryList:function(k,m,g){var c=Query.getDivObj(m);var b=c.parent();var f=$("#"+k);if(!f.valid()){return}var d="";var j="";$("th.sortable",b).each(function(){if(d==""){var n=$(this).attr("sortColumn");j=$(this).attr("defaultSort")||"";d=$(this).attr("defaultSort")?n:"";if(d!=""){$(this).siblings("th").andSelf().removeClass("asc desc");$(this).addClass(j);return false}else{return true}}});b.find("input[name=currentPage]").val("1");var h=$(f).serializeArray();var a=false;for(var e=0;e<h.length;e++){var l=h[e];if("prjCd"==l.name){a=true;break}}if(!a){h.push({name:"prjCd",value:getPrjCd()})}h.push({name:"sortColumn",value:d});h.push({name:"currentPage",value:"1"});h.push({name:"sortOrder",value:j});Query.pubQuery(h,m,g)},pubQuery:function(jsonData,_divId,str,flag){var divObj=Query.getDivObj(_divId);var $pObj=divObj.parent();var packet=new AJAXPacket(getGlobalPathRoot()+"oframe/common/page/page-list.gv");var pageSize=$pObj.find("input[name='pageSize']").val();if(!pageSize&&!jsonData.pageSize){pageSize=20}if(flag!="1"){jsonData.push({name:"divId",value:_divId});jsonData.push({name:"pageSize",value:pageSize});packet.data.data=jsonData}else{packet.data.add("divId",_divId);packet.data.add("pageSize",pageSize);packet.data.data=jsonData}core.ajax.sendPacketHtml(packet,function(response){var r=$(response);var toContain=$(".gridScroller tbody",divObj);if(toContain.length==0){toContain=divObj}var resultObj=r.find("tbody");if(resultObj.length==0){resultObj=r.find("#result")}var errMsg=$("input[name=errMsg]",r).val();if(errMsg!=""){alertMsg.error(errMsg)}else{toContain.html(resultObj.html());Query.refresh(divObj);$("button.btn-more",toContain).each(function(){$(this).bind("mouseover",function(){$(this).openBtnMenu()});$(this).mouseout(function(){$.fn.deActiveBtnMenu()})});if(r.find("#pagebox")){$pObj.find("div[id=pagebox]").length?$pObj.find("div[id=pagebox]").html(r.find("#pagebox").html()):divObj.after(r.find("#pagebox"))}core.ajax.loadjs(response);eval(str);$("#"+_divId).find(":button.checkboxCtrl, :checkbox.checkboxCtrl").each(function(i){$(this).removeAttr("checked")})}},true);packet=null},refresh:function(d){var c=$(d).find("div.gridThead table tr:first>th");if(c.length>0){var a=$(d).find("div.gridTbody table tr:first>td").addClass("fRow");a.each(function(e){var f=c.eq(e).width();$(this).width(f)})}var b=$(d).find("div.gridTbody table tbody>tr");b.hoverClass().each(function(){var f=$(this);var e=$(">td",this);f.click(function(){b.filter(".selected").removeClass("selected");f.addClass("selected")})});return false},exportExcel:function(_divId,colNames,colModels,translation){var divObj=Query.getDivObj(_divId);var $pObj=divObj.parent();var jsonData=$.parseJSON($("input[name=queryCondition]",$pObj).val());if(!jsonData){alertMsg.info("请先执行查询");return}jsonData.colNames=colNames||"";jsonData.colModels=colModels||"";if(translation){jsonData.translation=translation||""}var url=getGlobalPathRoot()+"oframe/common/page/page-export.gv";var packet=new AJAXPacket(url,"数据导出处理中, 请稍候......");packet.data.data=jsonData;core.ajax.sendPacketHtml(packet,function(response){var jsonData=eval("("+response+")");var isSuccess=jsonData.success;if(isSuccess){var downloadUrl=getGlobalPathRoot()+"oframe/common/file/file-down.gv?";downloadUrl=downloadUrl+"remoteFile="+encodeURI(jsonData.data.remoteFile);downloadUrl=downloadUrl+"&clientFile="+encodeURI(jsonData.data.clientFile);window.open(downloadUrl,"_self")}else{alertMsg.info(jsonData.errMsg)}},true);packet=null},exportExcelByTemplate:function(_divId,templatePath){var divObj=Query.getDivObj(_divId);var $pObj=divObj.parent();var jsonData=$.parseJSON($("input[name=queryCondition]",$pObj).val());if(!jsonData){alertMsg.info("请先执行查询");return}jsonData.templatePath=templatePath||"";var url=getGlobalPathRoot()+"oframe/common/page/page-export.gv";var packet=new AJAXPacket(url,"数据导出处理中, 请稍候......");packet.data.data=jsonData;core.ajax.sendPacketHtml(packet,function(response){var jsonData=eval("("+response+")");var isSuccess=jsonData.success;if(isSuccess){var downloadUrl=getGlobalPathRoot()+"oframe/common/file/file-down.gv?";downloadUrl=downloadUrl+"remoteFile="+encodeURI(jsonData.data.remoteFile);downloadUrl=downloadUrl+"&clientFile="+encodeURI(jsonData.data.clientFile);window.open(downloadUrl,"_self")}else{alertMsg.info(jsonData.errMsg)}},true);packet=null},expExcelWOPagination:function(g,f,d,h){var a=Query.getDivObj(g);var c=$(a).serializeArray();c.push({name:"colNames",value:f});c.push({name:"colModels",value:d});if(h){c.translation=h||""}var b=getGlobalPathRoot()+"npage/common/page/export.do";var e=new AJAXPacket(b,"数据导出处理中, 请稍候......");e.data.data=c;core.ajax.sendPacket(e,function(k){var l=k.data;var j=l.success;if(j){var m=getGlobalPathRoot()+"npage/common/page/download.do?";m=m+"remoteFile="+encodeURI(l.resultMap.remoteFile);m=m+"&clientFile="+encodeURI(l.resultMap.clientFile);window.open(m,"_self")}else{alertMsg.info(l.errMsg)}},true);e=null},jumpPage:function(c,e){if(e==""){return}var d=Query.getDivObj(e);var b=d.parent();b.find("input[name='currentPage']").val(c);var a=$.parseJSON(b.find("input[name='queryCondition']").val());a.currentPage=b.find("input[name='currentPage']").val();a.sortColumn=b.find("input[name='sortColumn']").val();a.sortOrder=b.find("input[name='sortOrder']").val();a.pageSize=b.find("input[name='pageSize']").val();Query.pubQuery(a,e,"","1")},skipTo:function(e){var d=Query.getDivObj(e);var b=d.parent();var c=b.find("input[name=skipToNo]").val();if(!isNaN(c)){var a=parseInt(c);if(a>0&&a<=parseInt(b.find("input[name='totalPage']").val())){Query.jumpPage(a,e)}else{b.find("input[name='skipToNo']").attr("value","")}}else{b.find("input[name='skipToNo']").attr("value","")}},sort:function(a,g){var f=Query.getDivObj(a);var e=f.parent();var d=$.parseJSON(e.find("input[name=queryCondition]").val());var h=$(g).attr("sortColumn");if(!d){alertMsg.info("请先执行查询")}else{$(g).siblings("th").andSelf().removeClass("asc desc");var c=e.find("input[name=sortOrder]").val();var b="";if(c==""||c=="desc"){b="asc"}else{b="desc"}e.find("input[name=sortOrder]").val(b);e.find("input[name=sortColumn]").val(h);$(g).addClass(b);Query.jumpPage(1,a)}}};var Page={getDivObj:function(c){var b=$("#"+c,navTab.getCurrentPanel());if($.pdialog.getCurrent()){var a=$("#"+c,$.pdialog.getCurrent());if(a.length>0){b=a}}return b},queryCondition:function(l,a){var m={left:25};if(a){m=$.extend(m,a)}var b=$(l);var f=m.showContainer;var n=[];var v=[];if(!f){n=b.closest("div.panelBar");v=n.next("div.tip")}if(b.hasClass("active")){b.removeClass("active");if(v.length>0){v.remove()}else{if(f){f.empty();if($.isFunction(m.closeCallBack)){m.closeCallBack()}}}}else{b.addClass("active");var h=m.formObj;var k=$("input[name=entityName]",h).val();var s=$("input[name=conditionName]",h).val();var e=$("input[name=condition]",h).val();var p=$("input[name=conditionValue]",h).val();var r=$("input.js_conditionValue",h).val();var t=$("input[name=resultField]",h).val();var q=$("input.js_canDefResult",h).val();var g=$("input.js_canDefCondition",h).val();var j=$("input[name=sortColumn]",h).val();var o=$("input[name=sortOrder]",h).val();var u=$("input[name=forceResultField]",h).val();var d=getGlobalPathRoot()+"oframe/common/page/page-condition.gv";var c=new AJAXPacket(d);c.data.add("prjCd",getPrjCd());c.data.add("entityName",k);c.data.add("conditionNames",s);c.data.add("conditions",e);c.data.add("conditionValues",p);c.data.add("canDefResult",q);c.data.add("canDefCondition",g);c.data.add("resultFields",t);c.data.add("conditionValueTexts",r);c.data.add("tabOpCode",navTab.getCurrentPanel().attr("opCode"));c.data.add("sortColumn",j?j:"");c.data.add("sortOrder",o?o:"");c.data.add("forceResultField",u?u:"");core.ajax.sendPacketHtml(c,function(x){var w=$(x);if(f){f.html(w);f.initUI()}else{var y=b.offset().left;w.prepend($('<div class="triangle triangle-up" style="border-bottom-color: #2c7bae;top: -10px; left: '+m.left+'px;"></div>'));n.after(w);w.initUI();if(m.height){w.css("height",m.height)}if(m.width){w.css("width",m.width)}}Page.relObj=b;Page.formObj=m.formObj;Page.changeConditions=m.changeConditions;if(m.callback){m.callback(f)}})}},queryConditionTwo:function(l,a){var m={left:25};if(a){m=$.extend(m,a)}var b=$(l);var f=m.showContainer;var n=[];var y=[];if(!f){n=b.closest("div.panelBar");y=n.next("div.tip")}if(b.hasClass("active")){b.removeClass("active");if(y.length>0){y.hide()}else{if(f){f.empty()}}}else{b.addClass("active");if(y.length>0){y.show();return}var h=m.formObj;var k=$("input[name=entityName]",h).val();var u=$("input[name=conditionName]",h).val();var e=$("input[name=condition]",h).val();var p=$("input[name=conditionValue]",h).val();var t=$("input[name=autoConditions]",h).val();var x=$("input[name=psConditions]",h).val();var s=$("input[name=tagConditions]",h).val();var r=$("input.js_conditionValue",h).val();var v=$("input[name=resultField]",h).val();var q=$("input.js_canDefResult",h).val();var g=$("input.js_canDefCondition",h).val();var j=$("input[name=sortColumn]",h).val();var o=$("input[name=sortOrder]",h).val();var w=$("input[name=forceResultField]",h).val();var d=getGlobalPathRoot()+"oframe/common/page/page-conditionTwo.gv";var c=new AJAXPacket(d);c.data.add("prjCd",getPrjCd());c.data.add("entityName",k);c.data.add("conditionNames",u);c.data.add("conditions",e);c.data.add("conditionValues",p);c.data.add("autoConditions",t);c.data.add("psConditions",x);c.data.add("tagConditions",s);c.data.add("canDefResult",q);c.data.add("canDefCondition",g);c.data.add("resultFields",v);c.data.add("conditionValueTexts",r);c.data.add("tabOpCode",navTab.getCurrentPanel().attr("opCode"));c.data.add("sortColumn",j?j:"");c.data.add("sortOrder",o?o:"");c.data.add("forceResultField",w?w:"");core.ajax.sendPacketHtml(c,function(A){var z=$(A);if(f){f.html(z);f.initUI()}else{var B=b.offset().left;z.prepend($('<div class="triangle triangle-up" style="border-bottom-color: #2c7bae;top: -10px; left: '+m.left+'px;"></div>'));n.after(z);z.initUI();if(m.height){z.css("height",m.height)}if(m.width){z.css("width",m.width)}}Page.relObj=b;Page.formObj=m.formObj;Page.changeConditions=m.changeConditions;if(m.callback){m.callback(f)}})}},queryPage:function(l,m,a){var d=Page.getDivObj(m);var b=d.parent();if(d.hasClass("js_page")){b=d}var h=$("#"+l);if(!h.valid()){return}var e="";var k="";var g=[];$("th",b).each(function(){var n=$(this);if(n.attr("fieldName")){g.push(n.attr("fieldName"))}if(n.hasClass("sortable")&&e==""){var o=n.attr("fieldName");k=n.attr("defaultSort")||"";e=n.attr("defaultSort")?o:"";if(e!=""){n.siblings("th").andSelf().removeClass("asc desc");n.addClass(k);return false}else{return true}}});b.find("input[name=currentPage]").val("1");var c=h.serializeArray();var j={};for(var f=0;f<c.length;f++){j[c[f].name]=c[f].value}j.resultFields=g.join(",");j.sortColumn=e;j.currentPage="1";j.sortOrder=k;j.prjCd=getPrjCd();Page.pubQuery(j,m,a)},pubQuery:function(jsonData,_divId,successEvalJs){var divObj=Page.getDivObj(_divId);var $pObj=divObj.parent();if(divObj.hasClass("js_page")){$pObj=divObj}var forward=jsonData.forward;if(forward.indexOf("forward:")==0){forward=forward.substr(8,forward.length)}var tempStr=forward.substr(1,forward.length);var url=getGlobalPathRoot()+"oframe/common/page/page-data.gv";if(jsonData.slfDefUrl){url=jsonData.slfDefUrl}var packet=new AJAXPacket(url);var pageSize=$pObj.find("input[name='pageSize']").val();if(!pageSize&&!jsonData.pageSize){pageSize=20}jsonData.divId=_divId;jsonData.pageSize=pageSize;packet.data.data=jsonData;core.ajax.sendPacketHtml(packet,function(response){var r=$(response);var toContain=$(".gridScroller tbody",divObj);if(toContain.length==0){toContain=divObj}var resultObj=r.find("tbody");if(resultObj.length==0){resultObj=r.find("#result")}var errMsg=$("input[name=errMsg]",r).val();if(errMsg!=""){alertMsg.error(errMsg)}else{toContain.html(resultObj.html());Page.refresh(divObj);$("button.btn-more",toContain).each(function(){$(this).bind("mouseover",function(){$(this).openBtnMenu()});$(this).mouseout(function(){$.fn.deActiveBtnMenu()})});if(r.find("#pagebox")){$pObj.find("div[id=pagebox]").length?$pObj.find("div[id=pagebox]").html(r.find("#pagebox").html()):divObj.after(r.find("#pagebox"))}core.ajax.loadjs(response);divObj.find(":button.checkboxCtrl, :checkbox.checkboxCtrl").each(function(i){$(this).removeAttr("checked")});if(successEvalJs&&successEvalJs!=""){eval(successEvalJs)}}},true);packet=null},refresh:function(d){var c=$(d).find("div.gridThead table tr:first>th");if(c.length>0){var a=$(d).find("div.gridTbody table tr:first>td").addClass("fRow");a.each(function(e){var f=c.eq(e).width();$(this).width(f)})}var b=$(d).find("div.gridTbody table tbody>tr");b.hoverClass().each(function(){var f=$(this);var e=$(">td",this);f.click(function(){b.filter(".selected").removeClass("selected");f.addClass("selected")})});return false},exportExcel:function(listDiv,allFlag){var divObj=Page.getDivObj(listDiv);var $pObj=divObj.parent();if(divObj.hasClass("js_page")){$pObj=divObj}var jsonData=$.parseJSON($("input[name=queryCondition]",$pObj).val());if(!jsonData){alertMsg.info("请先执行查询");return}jsonData.sortColumn=$pObj.find("input[name='sortColumn']").val();jsonData.sortOrder=$pObj.find("input[name='sortOrder']").val();var forward=jsonData.forward;if(forward.indexOf("forward:")==0){forward=forward.substr(8,forward.length)}var tempStr=forward.substr(1,forward.length);var url=getGlobalPathRoot()+"oframe/common/page/page-dataExport.gv";var packet=new AJAXPacket(url,"数据导出处理中, 请稍候......");packet.data.data=jsonData;core.ajax.sendPacketHtml(packet,function(response){var jsonData=eval("("+response+")");var isSuccess=jsonData.success;if(isSuccess){var downloadUrl=getGlobalPathRoot()+"oframe/common/file/file-down.gv?";downloadUrl=downloadUrl+"remoteFile="+encodeURI(jsonData.data.remoteFile);downloadUrl=downloadUrl+"&clientFile="+encodeURI(jsonData.data.clientFile);window.open(downloadUrl,"12313")}else{alertMsg.info(jsonData.errMsg)}},true);packet=null},exportExcelByTemplate:function(listDiv,templatePath,resultField){var divObj=Page.getDivObj(listDiv);var $pObj=divObj.parent();if(divObj.hasClass("js_page")){$pObj=divObj}var jsonData=$.parseJSON($("input[name=queryCondition]",$pObj).val());if(!jsonData){alertMsg.info("请先执行查询");return}jsonData.sortColumn=$pObj.find("input[name='sortColumn']").val();jsonData.sortOrder=$pObj.find("input[name='sortOrder']").val();jsonData.templatePath=templatePath||"";if(resultField){jsonData.resultField=resultField}if(!jsonData.resultField||jsonData.resultField==""){alertMsg.info("至少选择一个查询内容!");return}var forward=jsonData.forward;if(forward.indexOf("forward:")==0){forward=forward.substr(8,forward.length)}var tempStr=forward.substr(1,forward.length);var url=getGlobalPathRoot()+"oframe/common/page/page-dataExport.gv";var packet=new AJAXPacket(url,"数据导出处理中, 请稍候......");packet.data.data=jsonData;core.ajax.sendPacketHtml(packet,function(response){var jsonData=eval("("+response+")");var isSuccess=jsonData.success;if(isSuccess){var downloadUrl=getGlobalPathRoot()+"oframe/common/file/file-down.gv?";downloadUrl=downloadUrl+"remoteFile="+encodeURI(jsonData.data.remoteFile);downloadUrl=downloadUrl+"&clientFile="+encodeURI(jsonData.data.clientFile);window.open(downloadUrl,"_self")}else{alertMsg.info(jsonData.errMsg)}},true);packet=null},jumpPage:function(c,e){if(e==""){return}var d=Page.getDivObj(e);var b=d.parent();if(d.hasClass("js_page")){b=d}b.find("input[name='currentPage']").val(c);var a=$.parseJSON(b.find("input[name='queryCondition']").val());a.currentPage=b.find("input[name='currentPage']").val();a.sortColumn=b.find("input[name='sortColumn']").val();a.sortOrder=b.find("input[name='sortOrder']").val();a.pageSize=b.find("input[name='pageSize']").val();Page.pubQuery(a,e,null)},skipTo:function(e){var d=Page.getDivObj(e);var b=d.parent();if(d.hasClass("js_page")){b=d}var c=b.find("input[name=skipToNo]").val();if(!isNaN(c)){var a=parseInt(c);if(a>0&&a<=parseInt(b.find("input[name='totalPage']").val())){Page.jumpPage(a,e)}else{b.find("input[name='skipToNo']").attr("value","")}}else{b.find("input[name='skipToNo']").attr("value","")}},sort:function(f,g){var e=Page.getDivObj(f);var d=e.parent();if(e.hasClass("js_page")){d=e}var c=$.parseJSON(d.find("input[name=queryCondition]").val());var h=$(g).attr("fieldName");if(!c){alertMsg.info("请先执行查询")}else{$(g).siblings("th").andSelf().removeClass("asc desc");var b=d.find("input[name=sortOrder]").val();var a="";if(b==""||b=="desc"){a="asc"}else{a="desc"}d.find("input[name=sortOrder]").val(a);d.find("input[name=sortColumn]").val(h);$(g).addClass(a);Page.jumpPage(1,f)}},relObj:null,changeConditions:null,formObj:null,clearAll:function(b){var a=$("td.js_condition",$.pdialog.getCurrent());$("label.js_keyword",a).each(function(){if(!$(this).hasClass("hidden")){$(this).remove()}})},addQryField:function(a){var d=$(a);var c=d.closest("li");var b=c.clone();b.find("select,input").val("");c.after(b);b.initUI()},removeQryField:function(a){var c=$(a);var b=c.closest("li");if(b.siblings().length==0){b.find("select,input").val("")}else{b.remove()}},getOpt:function(obj){return{processData:function(result){var myData=[];for(var i=0;i<result.length;i++){var dataRow={};dataRow.data=result[i];dataRow.value=result[i].value;myData.push(dataRow)}return myData},showResult:function(value,data){return data.value},displayValue:function(value,data){return data.value},remoteDataType:"json",delay:300,minChars:0,maxItemsToShow:20,sortResults:null,filterResults:true,onItemSelect:function(obj){var data=obj.data;var source=$(obj.source);var $td=source.closest("li");$("input[name=conditionValue]",$td).val(data.key)},onNoMatch:function(obj){var source=$(obj.source);var $td=source.closest("li");var sltOption=$("select[name=conditionName]",$td).find("option:selected");if(sltOption.attr("frontSltRule")){$("input[name=conditionValue]",$td).val("");source.val("")}else{$("input[name=conditionValue]",$td).val(source.val())}},fetchData:function(obj){var resultData={};var $td=$(obj).closest("li");var sltOption=$("select[name=conditionName]",$td).find("option:selected");var frontSltRule=sltOption.attr("frontSltRule");if(frontSltRule&&frontSltRule!=""){var url=getGlobalPathRoot()+"oframe/sysmg/sys005/sys005-data.gv?";var ajaxPacket=new AJAXPacket(url);ajaxPacket.data.add("itemCd",frontSltRule);core.ajax.sendPacketHtml(ajaxPacket,function(response){resultData=eval("("+response+")")},false)}return resultData}}},getCondition:function(f){var c=$(f).closest("div.js_query_div");var h=[];var g=[];var e=[];var j=[];var b=[];var m=[];var a=[];$("ul.js_conditions_ul li.qry_cod",c).each(function(){var q=$(this);var o=q.attr("conditionName");var s=q.attr("condition");var r=q.attr("conditionValue");var p=$("span",q).html();if(!o||o==""){return true}else{h.push(o);g.push(s);e.push(r);j.push(p)}});var n=$("input[name=autoCondition]",c).val();var d=[];$("ul.js_ps_conditions_ul li.qry_ps_cod",c).each(function(){var w=$(this);var y=w.attr("conditionName");var p=w.attr("condition");var v=w.attr("conditionValue");if(!y||y==""){return true}else{var o=y.split(",");var q=p.split(",");var x=v.split(",");for(var s=0;s<o.length;s++){var t={};var u=o[s];var r=q[s];var z=x[s];t.conditionName=u;t.condition=r;t.conditionValue=z;d.push(t)}}});var l=[];$("ul.js_tag_conditions_ul li.qry_tag_cod",c).each(function(){var p={};var q=$(this);var o=q.attr("conditionName");var s=q.attr("condition");var r=q.attr("conditionValue");if(!o||o==""){return true}else{p.conditionName=o;p.condition=s;p.conditionValue=r}l.push(p)});$("ul.js_show_ul li.qry_cod",c).each(function(){var p=$(this);var q=p.attr("resultFieldName");if(q!=""){b.push(p.attr("resultFieldName"));var o=$("label:eq(0)",p);if(o.hasClass("asc")){m.push(p.attr("resultFieldName"));a.push("asc")}else{if(o.hasClass("desc")){m.push(p.attr("resultFieldName"));a.push("desc")}}}});if(b.length==0){alertMsg.info("至少选择一个查询内容!");return}var k={};k.conditionNames=h.join(",");k.conditions=g.join(",");k.conditionValues=e.join(",");k.conditionValueTexts=j.join(",");k.resultFields=b.join(",");k.sortColumn=m.join(",");k.sortOrder=a.join(",");k.autoConditions=n;k.psConditionsJson=JSON.stringify(d);k.tagConditionsJson=JSON.stringify(l);return k},saveCondition:function(e){var a=$(e).closest("div.js_query_div");var d=Page.getCondition(e);var c=$("input.js_entityName",a).val();var b=getGlobalPathRoot()+"oframe/common/page/page-fav.gv?entityName="+c;$.pdialog.open(b,"page-fav","检索收藏",{mask:true,max:false,max:false,maxable:false,resizable:false,width:500,height:250})},saveFav:function(entityName){var $favForm=$("#favForm",$.pdialog.getCurrent());if($favForm.valid()){var $button=$("button.js_saveCondition",navTab.getCurrentPanel());var favContent=Page.getCondition($button);var favName=$("input[name=favName]",$.pdialog.getCurrent()).val();var favFlag="0";if($("input[name=favFlag]").attr("checked")=="checked"){favFlag="1"}var packet=new AJAXPacket();packet.data.add("favName",favName);packet.data.add("entityName",entityName);packet.data.add("favFlag",favFlag);packet.data.add("tabOpCode",navTab.getCurrentPanel().attr("opCode"));packet.data.add("favContent",JSON.stringify(favContent));packet.url=getGlobalPathRoot()+"oframe/common/page/page-saveFav.gv?prjCd="+getPrjCd();core.ajax.sendPacketHtml(packet,function(response){var jsonData=eval("("+response+")");if(jsonData.success){var container=$("div.js_query_div",navTab.getCurrentPanel());var favContainer=$("#fav",container);if(favFlag=="1"){var spanTemplate=favContainer.find("span.my_fav:eq(0)")}else{var spanTemplate=favContainer.find("span.my_fav:eq(1)")}var newSpan=spanTemplate.clone();$("label.js_fav_name",newSpan).html(favName);newSpan.attr("favId",jsonData.favId);newSpan.show();favContainer.append(newSpan);$.pdialog.closeCurrent()}else{alertMsg.error(jsonData.msg)}})}},deletefav:function(b,a){alertMsg.confirm("是否删除该收藏？",{okCall:function(){var d=new AJAXPacket();var c=$(b).closest("span").attr("favId");d.data.add("favId",c);d.data.add("entityName","StaffFavoriteCondition");d.data.add("prjCd",getPrjCd());d.url=getGlobalPathRoot()+"oframe/common/page/page-deleteFav.gv";core.ajax.sendPacketHtml(d,function(e){$(b).closest("span").remove()})}});stopEvent(event)},submitCondition:function(c){var a=$(c).closest("div.js_query_div");var b=Page.getCondition(c);Page.applyCondition(c,b)},clickFav:function(obj,favId){var packet=new AJAXPacket();var prjCd=getPrjCd();var favId=$(obj).attr("favId");packet.data.add("favId",favId);packet.data.add("prjCd",getPrjCd());packet.url=getGlobalPathRoot()+"oframe/common/page/page-queryFav.gv";core.ajax.sendPacketHtml(packet,function(response){var jsonData=eval("("+response+")");if(jsonData.success){var infofav=jsonData.infofav;Page.applyCondition(obj,infofav)}})},closeCondition:function(b){var a=$(b).closest("div.js_query_div");a.remove();if(Page.relObj){Page.relObj.removeClass("active")}ph005Map.closeHsConditions();Page.changeConditions=null;Page.relObj=null;Page.formObj=null},closeConditionTwo:function(b){var a=$(b).closest("div.js_query_div");a.hide();if(Page.relObj){Page.relObj.removeClass("active")}},applyCondition:function(e,d){var b=$(e).closest("div.js_query_div");if(!d){d=Page.getCondition(e)}if($.isFunction(Page.changeConditions)){Page.changeConditions(d)}else{if(Page.formObj){var a=Page.formObj;$("input[name=conditionName]",a).val(d.conditionNames);$("input[name=condition]",a).val(d.conditions);$("input[name=conditionValue]",a).val(d.conditionValues);$("input.js_conditionValue",a).val(d.conditionValueTexts);$("input[name=resultField]",a).val(d.resultFields);$("input[name=sortColumn]",a).val(d.sortColumn);$("input[name=sortOrder]",a).val(d.sortOrder);$("input[name=autoConditions]",a).val(d.autoConditions);$("input[name=psConditions]",a).val(d.psConditionsJson);$("input[name=tagConditions]",a).val(d.tagConditionsJson);Page.query(Page.formObj,"")}}var c=$(e).attr("class");if(c==="my_fav"){b.remove()}else{b.hide()}if(Page.relObj){Page.relObj.removeClass("active")}if(c==="my_fav"){Page.changeConditions=null;Page.relObj=null;Page.formObj=null}},query:function(formObj,successEvalJs){var forward=$("input[name=forward]",formObj).val();if(forward.indexOf("forward:")==0){forward=forward.substr(8,forward.length)}var tempStr=forward.substr(1,forward.length);var modelName=tempStr.substr(0,tempStr.indexOf("/"));var url=getGlobalPathRoot()+"oframe/common/page/page-data.gv";var slfDefUrl=$("input[name=slfDefUrl]",formObj).val();if(slfDefUrl&&slfDefUrl!=""){url=slfDefUrl}var packet=new AJAXPacket(url);packet.data.data=formObj.serializeArray();packet.data.data.push({name:"currentPage",value:1});packet.data.data.push({name:"pageSize",value:20});packet.data.data.push({name:"prjCd",value:getPrjCd()});core.ajax.sendPacketHtml(packet,function(response){var r=$(response);var errMsg=$("input[name=errMsg]",r).val();if(errMsg!=""){alertMsg.error(errMsg)}else{var resultDiv=$(formObj).next("div.js_page");if(resultDiv.length==0){resultDiv=$("<div class='js_page'></div>");$(formObj).after(resultDiv)}var divOver=resultDiv.css("overflow");resultDiv.css("overflow","hidden");resultDiv.html(response);resultDiv.initUI();resultDiv.css("overflow",divOver);if(successEvalJs&&successEvalJs!=""){eval(successEvalJs)}}},true);packet=null},queryWithTag:function(formObj,successEvalJs){var forward=$("input[name=forward]",formObj).val();if(forward.indexOf("forward:")==0){forward=forward.substr(8,forward.length)}var tempStr=forward.substr(1,forward.length);var modelName=tempStr.substr(0,tempStr.indexOf("/"));var url=getGlobalPathRoot()+"oframe/common/page/page-dataWithTag.gv";var packet=new AJAXPacket(url);packet.data.data=formObj.serializeArray();packet.data.data.push({name:"currentPage",value:1});packet.data.data.push({name:"pageSize",value:20});packet.data.data.push({name:"prjCd",value:getPrjCd()});core.ajax.sendPacketHtml(packet,function(response){var r=$(response);var errMsg=$("input[name=errMsg]",r).val();if(errMsg!=""){alertMsg.error(errMsg)}else{var resultDiv=$(formObj).next("div.js_page");if(resultDiv.length==0){resultDiv=$("<div class='js_page'></div>");$(formObj).after(resultDiv)}var divOver=resultDiv.css("overflow");resultDiv.css("overflow","hidden");resultDiv.html(response);resultDiv.initUI();resultDiv.css("overflow",divOver);if(successEvalJs&&successEvalJs!=""){eval(successEvalJs)}}},true);packet=null},changeSort:function(b){var a=$(b);if(a.hasClass("asc")){a.removeClass("asc").addClass("desc")}else{if(a.hasClass("desc")){a.removeClass("desc")}else{a.addClass("asc")}}return false},sltAllResult:function(a){$(a).closest("td").find("input[type=checkbox]").attr("checked",true)},clearAllResult:function(a){$(a).closest("td").find("input[type=checkbox]").each(function(){var b=$(this);if(!b.attr("disabled")){b.removeAttr("checked")}})},getStaffUrl:function(a){return getGlobalPathRoot()+"oframe/common/auto/auto-data.gv?subSvcName=sys002Data"},getStaffOption:function(a){return{processData:function(b){var d=[];for(i=0;i<b.length;i++){var c={};c.data=b[i];c.value=b[i].STAFF_NAME;d.push(c)}return d},showResult:function(c,b){return b.STAFF_NAME+" ( "+b.STAFF_CODE+" ) "},mustMatch:false,remoteDataType:"json",autoFill:false,delay:300,minChars:0,onItemSelect:function(b){$("input[type=hidden]",$(b.source).parent()).val(b.data.STAFF_ID)},onNoMatch:function(b){$("input[name=hidden]",$(b.source).parent()).val("")}}}};